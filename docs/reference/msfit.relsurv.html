<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Extend a multi-state model using relative survival — msfit.relsurv • mstate</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Extend a multi-state model using relative survival — msfit.relsurv"><meta name="description" content="A function that takes a fitted msfit object and upgrades
it using relative survival, where chosen transitions are
split in population and excess transitions. This upgraded
msfit object contains the split hazards based on the transition
matrix (transMat). The (co)variance matrix is also upgraded, if provided."><meta property="og:description" content="A function that takes a fitted msfit object and upgrades
it using relative survival, where chosen transitions are
split in population and excess transitions. This upgraded
msfit object contains the split hazards based on the transition
matrix (transMat). The (co)variance matrix is also upgraded, if provided."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mstate</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/visuals_demo.html">Visualising multi-state models using mstate</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/hputter/mstate/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Extend a multi-state model using relative survival</h1>
      <small class="dont-index">Source: <a href="https://github.com/hputter/mstate/blob/HEAD/R/relsurv.msfit.relsurv.R" class="external-link"><code>R/relsurv.msfit.relsurv.R</code></a></small>
      <div class="d-none name"><code>msfit.relsurv.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>A function that takes a fitted msfit object and upgrades
it using relative survival, where chosen transitions are
split in population and excess transitions. This upgraded
msfit object contains the split hazards based on the transition
matrix (transMat). The (co)variance matrix is also upgraded, if provided.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">msfit.relsurv</span><span class="op">(</span></span>
<span>  <span class="va">msfit.obj</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">split.transitions</span>,</span>
<span>  ratetable <span class="op">=</span> <span class="fu">relsurv</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/relsurv/man/slopop.html" class="external-link">slopop</a></span>,</span>
<span>  <span class="va">rmap</span>,</span>
<span>  time.format <span class="op">=</span> <span class="st">"days"</span>,</span>
<span>  var.pop.haz <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"fixed"</span>, <span class="st">"bootstrap"</span>, <span class="st">"both"</span><span class="op">)</span>,</span>
<span>  B <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  seed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">add.times</span>,</span>
<span>  substitution <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  link_trans_ind <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-msfit-obj">msfit.obj<a class="anchor" aria-label="anchor" href="#arg-msfit-obj"></a></dt>
<dd><p>The msfit object which has to be upgraded</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>The data used for fitting the msfit model</p></dd>


<dt id="arg-split-transitions">split.transitions<a class="anchor" aria-label="anchor" href="#arg-split-transitions"></a></dt>
<dd><p>An integer vector containing the numbered transitions that should be split. Use same numbering as in the given transition matrix</p></dd>


<dt id="arg-ratetable">ratetable<a class="anchor" aria-label="anchor" href="#arg-ratetable"></a></dt>
<dd><p>The population mortality table. A table of event rates, organized as a ratetable object, see for example relsurv::slopop. Default is slopop</p></dd>


<dt id="arg-rmap">rmap<a class="anchor" aria-label="anchor" href="#arg-rmap"></a></dt>
<dd><p>An optional list to be used if the variables in the data are not organized (and named) in the same way as in the ratetable object</p></dd>


<dt id="arg-time-format">time.format<a class="anchor" aria-label="anchor" href="#arg-time-format"></a></dt>
<dd><p>Define the time format which is used in the data. Possible options: c('days', 'years', 'months'). Default is 'days'</p></dd>


<dt id="arg-var-pop-haz">var.pop.haz<a class="anchor" aria-label="anchor" href="#arg-var-pop-haz"></a></dt>
<dd><p>If 'fixed' (default), the Greenwood estimator for the variances is used, where it is assumed that the variance of the population hazards is zero. If 'bootstrap', one gets boostrap estimates for all all transitions. Option 'both' gives both variance estimates</p></dd>


<dt id="arg-b">B<a class="anchor" aria-label="anchor" href="#arg-b"></a></dt>
<dd><p>Number of bootstrap replications. Relevant only if var.pop.haz == 'bootstrap' or 'both'. Default is B=10.</p></dd>


<dt id="arg-seed">seed<a class="anchor" aria-label="anchor" href="#arg-seed"></a></dt>
<dd><p>Set seed</p></dd>


<dt id="arg-add-times">add.times<a class="anchor" aria-label="anchor" href="#arg-add-times"></a></dt>
<dd><p>Additional times at which hazards should be evaluated</p></dd>


<dt id="arg-substitution">substitution<a class="anchor" aria-label="anchor" href="#arg-substitution"></a></dt>
<dd><p>Whether function substitute should be used for rmap argument. Default is TRUE</p></dd>


<dt id="arg-link-trans-ind">link_trans_ind<a class="anchor" aria-label="anchor" href="#arg-link-trans-ind"></a></dt>
<dd><p>Choose whether the linkage between the old and new transition matrix should be saved. Default is FALSE.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Returns a msfit object that contains estimates for the extended model
with split (population and excess) transitions.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Manevski D, Putter H, Pohar Perme M, Bonneville EF, Schetelig J, de Wreede LC (2021).
Integrating relative survival in multi-state models – a non-parametric approach.
https://arxiv.org/abs/2106.12399</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="msfit.html">msfit</a></code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Damjan Manevski <a href="mailto:damjan.manevski@mf.uni-lj.si">damjan.manevski@mf.uni-lj.si</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hputter/mstate" class="external-link">mstate</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Load dataset:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"ebmt1"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Transition matrix:</span></span></span>
<span class="r-in"><span><span class="va">tmat</span> <span class="op">&lt;-</span> <span class="fu"><a href="transMat.html">transMat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>                 names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Alive relapse-free"</span>, <span class="st">"Relapse"</span>,<span class="st">"NRM"</span>, <span class="st">"DaR"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Data in long format using msprep</span></span></span>
<span class="r-in"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="msprep.html">msprep</a></span><span class="op">(</span>time<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="st">"rel"</span>,<span class="st">"srv"</span>,<span class="st">"srv"</span><span class="op">)</span>, status<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="st">"relstat"</span>,<span class="st">"srvstat"</span>,<span class="st">"srvstat"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>             data<span class="op">=</span><span class="va">ebmt1</span>, trans<span class="op">=</span><span class="va">tmat</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Generate demographic covariates (which are usually present in datasets) </span></span></span>
<span class="r-in"><span><span class="co"># and based on them estimate the population hazard.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">510</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">df</span><span class="op">$</span><span class="va">age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>, <span class="fl">45</span>, <span class="fl">65</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">df</span><span class="op">$</span><span class="va">sex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"male"</span>, <span class="st">"female"</span><span class="op">)</span>, size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">df</span><span class="op">$</span><span class="va">dateHCT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">'1990/01/01'</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">'2000/01/01'</span><span class="op">)</span>, by<span class="op">=</span><span class="st">"day"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># generate years</span></span></span>
<span class="r-in"><span><span class="co"># Cox object:</span></span></span>
<span class="r-in"><span><span class="va">cx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">Tstart</span>,<span class="va">Tstop</span>,<span class="va">status</span><span class="op">)</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/strata.html" class="external-link">strata</a></span><span class="op">(</span><span class="va">trans</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>            data<span class="op">=</span><span class="va">df</span>,method<span class="op">=</span><span class="st">"breslow"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Basic multi-state model:</span></span></span>
<span class="r-in"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="msfit.html">msfit</a></span><span class="op">(</span><span class="va">cx</span>,trans<span class="op">=</span><span class="va">tmat</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Extended multi-state model, where the two transition</span></span></span>
<span class="r-in"><span><span class="co"># reaching death are split in excess and population parts.</span></span></span>
<span class="r-in"><span><span class="co"># We assume patients live like in the Slovene population,</span></span></span>
<span class="r-in"><span><span class="co"># thus we use Slovene mortality tables in this example.</span></span></span>
<span class="r-in"><span><span class="co"># Variances estimated using 25 bootstrap replications.</span></span></span>
<span class="r-in"><span><span class="va">mod.relsurv</span> <span class="op">&lt;-</span> <span class="fu">msfit.relsurv</span><span class="op">(</span>msfit.obj <span class="op">=</span> <span class="va">mod</span>, data<span class="op">=</span><span class="va">df</span>, split.transitions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                            ratetable <span class="op">=</span> <span class="fu">relsurv</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/relsurv/man/slopop.html" class="external-link">slopop</a></span>, </span></span>
<span class="r-in"><span>                            rmap <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>age<span class="op">=</span><span class="va">age</span><span class="op">*</span><span class="fl">365.241</span>, year<span class="op">=</span><span class="va">dateHCT</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                            time.format <span class="op">=</span> <span class="st">"days"</span>,</span></span>
<span class="r-in"><span>                            var.pop.haz <span class="op">=</span> <span class="st">"bootstrap"</span>,</span></span>
<span class="r-in"><span>                            B <span class="op">=</span> <span class="fl">25</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Estimate transition probabilities:</span></span></span>
<span class="r-in"><span><span class="va">pt</span> <span class="op">&lt;-</span> <span class="fu"><a href="probtrans.html">probtrans</a></span><span class="op">(</span><span class="va">mod.relsurv</span>, predt<span class="op">=</span><span class="fl">0</span>, method<span class="op">=</span><span class="st">'greenwood'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Estimated cumulative hazards with the corresponding </span></span></span>
<span class="r-in"><span><span class="co"># bootstrap standard errors at 300, 600, 900 days:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">mod.relsurv</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">300</span>, <span class="fl">600</span>, <span class="fl">900</span><span class="op">)</span>, conf.type <span class="op">=</span> <span class="st">'log'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Estimated transition probabilities together with the corresponding </span></span></span>
<span class="r-in"><span><span class="co"># bootstrap standard errors and log.boot confidence intervals </span></span></span>
<span class="r-in"><span><span class="co"># at 300, 600, 900 days:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">pt</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">300</span>, <span class="fl">600</span>, <span class="fl">900</span><span class="op">)</span>, conf.type <span class="op">=</span> <span class="st">'log'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Plot the measures:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mod.relsurv</span>, use.ggplot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pt</span>, use.ggplot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Hein Putter, Liesbeth C. de Wreede, Marta Fiocco, Edouard F. Bonneville.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

